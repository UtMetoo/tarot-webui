<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>部署测试页面</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            min-height: 100vh;
        }
        .container {
            background: rgba(255, 255, 255, 0.1);
            padding: 30px;
            border-radius: 15px;
            backdrop-filter: blur(10px);
        }
        h1 {
            text-align: center;
            margin-bottom: 30px;
        }
        .status {
            background: rgba(255, 255, 255, 0.2);
            padding: 15px;
            border-radius: 8px;
            margin: 10px 0;
        }
        .success {
            background: rgba(76, 175, 80, 0.3);
        }
        .error {
            background: rgba(244, 67, 54, 0.3);
        }
        button {
            background: #667eea;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover {
            background: #5a6fd8;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>🚀 部署测试页面</h1>
        
        <div class="status success">
            <h3>✅ 静态文件部署成功</h3>
            <p>如果您能看到这个页面，说明静态文件部署正常。</p>
        </div>

        <div class="status">
            <h3>🔧 API 测试</h3>
            <p>点击下面的按钮测试 API 是否正常工作：</p>
            <button onclick="testDebugAPI()">测试调试 API</button>
            <button onclick="testTarotAPI()">测试塔罗牌 API</button>
            <div id="apiResult"></div>
        </div>

        <div class="status">
            <h3>📋 部署检查清单</h3>
            <ul>
                <li>✅ 静态文件可访问</li>
                <li id="apiCheck">⏳ API 连接测试中...</li>
                <li id="envCheck">⏳ 环境变量检查中...</li>
            </ul>
        </div>

        <div class="status">
            <h3>🔗 重要链接</h3>
            <p><a href="/" style="color: white;">🏠 返回主页</a></p>
            <p><a href="/api/debug" style="color: white;">🔍 调试信息</a></p>
        </div>
    </div>

    <script>
        // 页面加载时自动测试
        window.onload = function() {
            testDebugAPI();
        };

        async function testDebugAPI() {
            const resultDiv = document.getElementById('apiResult');
            const apiCheck = document.getElementById('apiCheck');
            const envCheck = document.getElementById('envCheck');
            
            try {
                resultDiv.innerHTML = '<p>正在测试调试 API...</p>';
                
                const response = await fetch('/api/debug');
                const data = await response.json();
                
                if (response.ok) {
                    apiCheck.innerHTML = '✅ API 连接正常';
                    envCheck.innerHTML = data.hasApiKey && data.hasWorkflowId ? 
                        '✅ 环境变量配置正确' : 
                        '❌ 环境变量配置错误';
                    
                    resultDiv.innerHTML = `
                        <div class="success">
                            <h4>调试信息：</h4>
                            <pre>${JSON.stringify(data, null, 2)}</pre>
                        </div>
                    `;
                } else {
                    throw new Error(`HTTP ${response.status}`);
                }
            } catch (error) {
                apiCheck.innerHTML = '❌ API 连接失败';
                envCheck.innerHTML = '❌ 无法检查环境变量';
                
                resultDiv.innerHTML = `
                    <div class="error">
                        <h4>错误信息：</h4>
                        <p>${error.message}</p>
                    </div>
                `;
            }
        }

        async function testTarotAPI() {
            const resultDiv = document.getElementById('apiResult');
            
            try {
                resultDiv.innerHTML = '<p>正在测试塔罗牌 API...</p>';
                
                const response = await fetch('/api/tarot', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        birthday: '1990-01-01 12:00',
                        gender: '女',
                        city: '北京市',
                        question: '测试问题'
                    })
                });
                
                if (response.ok) {
                    resultDiv.innerHTML = `
                        <div class="success">
                            <h4>✅ 塔罗牌 API 测试成功</h4>
                            <p>API 响应正常，可以正常使用占卜功能。</p>
                        </div>
                    `;
                } else {
                    const errorData = await response.json();
                    throw new Error(errorData.error || `HTTP ${response.status}`);
                }
            } catch (error) {
                resultDiv.innerHTML = `
                    <div class="error">
                        <h4>❌ 塔罗牌 API 测试失败</h4>
                        <p>错误信息：${error.message}</p>
                        <p>请检查环境变量配置。</p>
                    </div>
                `;
            }
        }
    </script>
</body>
</html>
