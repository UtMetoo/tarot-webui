<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>éƒ¨ç½²æµ‹è¯•é¡µé¢</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            min-height: 100vh;
        }
        .container {
            background: rgba(255, 255, 255, 0.1);
            padding: 30px;
            border-radius: 15px;
            backdrop-filter: blur(10px);
        }
        h1 {
            text-align: center;
            margin-bottom: 30px;
        }
        .status {
            background: rgba(255, 255, 255, 0.2);
            padding: 15px;
            border-radius: 8px;
            margin: 10px 0;
        }
        .success {
            background: rgba(76, 175, 80, 0.3);
        }
        .error {
            background: rgba(244, 67, 54, 0.3);
        }
        button {
            background: #667eea;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover {
            background: #5a6fd8;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸš€ éƒ¨ç½²æµ‹è¯•é¡µé¢</h1>
        
        <div class="status success">
            <h3>âœ… é™æ€æ–‡ä»¶éƒ¨ç½²æˆåŠŸ</h3>
            <p>å¦‚æœæ‚¨èƒ½çœ‹åˆ°è¿™ä¸ªé¡µé¢ï¼Œè¯´æ˜é™æ€æ–‡ä»¶éƒ¨ç½²æ­£å¸¸ã€‚</p>
        </div>

        <div class="status">
            <h3>ğŸ”§ API æµ‹è¯•</h3>
            <p>ç‚¹å‡»ä¸‹é¢çš„æŒ‰é’®æµ‹è¯• API æ˜¯å¦æ­£å¸¸å·¥ä½œï¼š</p>
            <button onclick="testDebugAPI()">æµ‹è¯•è°ƒè¯• API</button>
            <button onclick="testTarotAPI()">æµ‹è¯•å¡”ç½—ç‰Œ API</button>
            <div id="apiResult"></div>
        </div>

        <div class="status">
            <h3>ğŸ“‹ éƒ¨ç½²æ£€æŸ¥æ¸…å•</h3>
            <ul>
                <li>âœ… é™æ€æ–‡ä»¶å¯è®¿é—®</li>
                <li id="apiCheck">â³ API è¿æ¥æµ‹è¯•ä¸­...</li>
                <li id="envCheck">â³ ç¯å¢ƒå˜é‡æ£€æŸ¥ä¸­...</li>
            </ul>
        </div>

        <div class="status">
            <h3>ğŸ”— é‡è¦é“¾æ¥</h3>
            <p><a href="/" style="color: white;">ğŸ  è¿”å›ä¸»é¡µ</a></p>
            <p><a href="/api/debug" style="color: white;">ğŸ” è°ƒè¯•ä¿¡æ¯</a></p>
        </div>
    </div>

    <script>
        // é¡µé¢åŠ è½½æ—¶è‡ªåŠ¨æµ‹è¯•
        window.onload = function() {
            testDebugAPI();
        };

        async function testDebugAPI() {
            const resultDiv = document.getElementById('apiResult');
            const apiCheck = document.getElementById('apiCheck');
            const envCheck = document.getElementById('envCheck');
            
            try {
                resultDiv.innerHTML = '<p>æ­£åœ¨æµ‹è¯•è°ƒè¯• API...</p>';
                
                const response = await fetch('/api/debug');
                const data = await response.json();
                
                if (response.ok) {
                    apiCheck.innerHTML = 'âœ… API è¿æ¥æ­£å¸¸';
                    envCheck.innerHTML = data.hasApiKey && data.hasWorkflowId ? 
                        'âœ… ç¯å¢ƒå˜é‡é…ç½®æ­£ç¡®' : 
                        'âŒ ç¯å¢ƒå˜é‡é…ç½®é”™è¯¯';
                    
                    resultDiv.innerHTML = `
                        <div class="success">
                            <h4>è°ƒè¯•ä¿¡æ¯ï¼š</h4>
                            <pre>${JSON.stringify(data, null, 2)}</pre>
                        </div>
                    `;
                } else {
                    throw new Error(`HTTP ${response.status}`);
                }
            } catch (error) {
                apiCheck.innerHTML = 'âŒ API è¿æ¥å¤±è´¥';
                envCheck.innerHTML = 'âŒ æ— æ³•æ£€æŸ¥ç¯å¢ƒå˜é‡';
                
                resultDiv.innerHTML = `
                    <div class="error">
                        <h4>é”™è¯¯ä¿¡æ¯ï¼š</h4>
                        <p>${error.message}</p>
                    </div>
                `;
            }
        }

        async function testTarotAPI() {
            const resultDiv = document.getElementById('apiResult');
            
            try {
                resultDiv.innerHTML = '<p>æ­£åœ¨æµ‹è¯•å¡”ç½—ç‰Œ API...</p>';
                
                const response = await fetch('/api/tarot', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        birthday: '1990-01-01 12:00',
                        gender: 'å¥³',
                        city: 'åŒ—äº¬å¸‚',
                        question: 'æµ‹è¯•é—®é¢˜'
                    })
                });
                
                if (response.ok) {
                    resultDiv.innerHTML = `
                        <div class="success">
                            <h4>âœ… å¡”ç½—ç‰Œ API æµ‹è¯•æˆåŠŸ</h4>
                            <p>API å“åº”æ­£å¸¸ï¼Œå¯ä»¥æ­£å¸¸ä½¿ç”¨å åœåŠŸèƒ½ã€‚</p>
                        </div>
                    `;
                } else {
                    const errorData = await response.json();
                    throw new Error(errorData.error || `HTTP ${response.status}`);
                }
            } catch (error) {
                resultDiv.innerHTML = `
                    <div class="error">
                        <h4>âŒ å¡”ç½—ç‰Œ API æµ‹è¯•å¤±è´¥</h4>
                        <p>é”™è¯¯ä¿¡æ¯ï¼š${error.message}</p>
                        <p>è¯·æ£€æŸ¥ç¯å¢ƒå˜é‡é…ç½®ã€‚</p>
                    </div>
                `;
            }
        }
    </script>
</body>
</html>
